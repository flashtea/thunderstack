<div class="container mx-auto px-8 pt-4" *ngIf="question?.title">
  <div class="flex items-center mb-4">
    <a [routerLink]="['/home']" class="flex items-center m-l-0 mr-4">
      <fa-icon [icon]="faChevronLeft" class="m-t-2"></fa-icon>
    </a>
    <h1 class="text-xl font-bold">{{ question.title }}</h1>
  </div>
  <div class="mb-6 prose dark:prose-invert prose-sm">
    <markdown ngPreserveWhitespaces [data]="question.message"></markdown>
  </div>
  <h2 class="text-lg font-bold mb-2">Answers</h2>
  <div class="mb-4" *ngFor="let answer of answers">
    <div class="mb-4 flex" *ngIf="answer.id && answer.pubkey">
      <div class="flex flex-col items-center mr-4 mt-4">
        <button class="text-blue-500" (click)="upvoteAnswer(answer.id, answer.pubkey)">
          <fa-icon [icon]="faChevronUp"></fa-icon>
        </button>
        <span class="font-bold">{{answer.vote}}</span>
        <button class="text-red-500" (click)="downvoteAnswer(answer.id, answer.pubkey)">
          <fa-icon [icon]="faChevronDown"></fa-icon>
        </button>
      </div>
      <div class="bg-white dark:bg-gray-800/25 p-4 shadow-md rounded-lg flex-grow">
        <div class="mb-4 prose dark:prose-invert prose-sm break-all">
          <markdown ngPreserveWhitespaces [data]="answer.message"></markdown>
        </div>
        <hr class="w-full border-gray-200 dark:border-gray-800 mb-2">
        <div class="flex items-center">
          <button class="flex items-center" (click)="toggleTip(answer)" *ngIf="answer.profile?.lud16">
            <fa-icon [icon]="faBolt" class="text-yellow-500"></fa-icon>
            <span class="ml-2">{{ answer.zaps || 0 }}</span>
          </button>
          <div class="flex items-center ml-auto">
            <img src="{{ answer.profile?.picture || '/assets/images/user-placeholder.png' }}" class="w-6 h-6 rounded-full mr-2" alt="profile picture">
            <span class="">{{ answer.profile?.name || 'Anonymous' }}</span>
          </div>
        </div>
        
      </div>
    </div>
  </div>

  
  <div class="bg-white dark:bg-gray-800/25 p-4 shadow-md rounded-lg md:ml-8 mb-6">
    <form (submit)="createAnswer()">
      <textarea 
        name="answer" 
        [(ngModel)]="answer" 
        class="w-full p-2 border-[1px] border-slate-200 dark:border-slate-800 rounded mb-4 bg-white dark:bg-gray-800/25" 
        placeholder="Add a answer...">
      </textarea>
      <button type="submit" class="bg-blue-500 text-white px-4 py-2 rounded-full hover:bg-blue-400">Add Answer</button>
    </form>
  </div>
</div>

<div class="fixed inset-0 z-50 flex items-center justify-center w-full h-full" [class.hidden]="!tip.answer">
  <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 w-full md:w-1/2 lg:w-1/3 xl:w-1/4 m-6" *ngIf="tip.answer">
    <div class="font-medium text-lg mb-4">
      Tip Answer
    </div>
    <div class="text-sm mb-4">
      How much would you like to tip this answer?
    </div>
    <div class="flex items-center mb-4">
      <input
        [(ngModel)]="tip.amount"
        type="number"
        class="w-full dark:bg-gray-700 text-sm mr-4 border-gray-300 rounded-md py-2 px-3 focus:border-indigo-500 focus:outline-none focus:ring focus:ring-indigo-200"
        placeholder="Enter amount"
        min="1"
        max="10000"
      />
    </div>
    <div class="flex justify-end">
      <button
        *ngIf="!tip.invoiceCode"
        (click)="sendTip(tip.answer, tip.amount)"
        class="bg-yellow-500 hover:bg-yellow-600 text-white rounded-md px-4 py-2 mr-2"
      >
        Send Tip
      </button>
      <a
          class="bg-yellow-500 hover:bg-yellow-600 text-white rounded-md px-12 py-2 mr-2"
          *ngIf="tip.invoiceCode"
          [href]="getLightningLink(tip.invoiceCode)"
          target="_blank"
          rel="noopener"
        >
          Pay
      </a>
      <button
        (click)="toggleTip(tip.answer)"
        class="text-yellow-500 hover:text-yellow-600 mr-4"
      >
        Cancel
      </button>
    </div>
  </div>
</div>


